<!doctype html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.js"></script>

    <title>Websocket Chat</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>
<body>

    <input type="text" id="name">
    <input type="button" onclick="connect();" value="connect" >
    <input type="text" id="msg">
    <input type="button" onclick="send();" value="send" >
    <input type="text" id="create">
    <input type="button" onclick="createRoom();" value="채팅방 생성" >
    <input type="text" id="targetRoom">
    <input type="button" onclick="targetRoom();" value="채팅방 조회" >
</body>
<script>
    let stompClient;

    /**
     * 설정파읠의 websocket
     */
    function connect() {
        // let socket = new SockJS("/websocket",null,{transports: ["default"]});
        let socket = new SockJS("/websocket");
        console.log("남규니 = ", socket)
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            console.log('conneted:' + frame);
            stompClient.subscribe('/topic/users', function (response) {
                console.log(response);
                console.log(JSON.parse(response.body));
            });
        });
    }

    /**
     * 첫번째 인자는 설정파일의 app과 컨트롤러의 매핑주소 user
     * 두번째 인자는 서버로 보낼때 추가하고싶은 헤더
     * 세번째 인자는 서버로 보낼 바디
     */
    function send(){
        console.log('sending');
        let name=document.getElementById("name").value;
        let msg=document.getElementById("msg").value;
        stompClient.send("/app/user",{},JSON.stringify({name: name,msg:msg}))

    }
    let create=document.getElementById("create").value;


    function createRoom(){
        $.ajax({
            type: "POST",
            url: "/room",
            data: {
                "roomId": create
            },
            success: function (data){
            }

        });
    }
    let targetRoom=document.getElementById("targetRoom").value;

    function targetRoom(){
        $.ajax({
            type: "POST",
            url: "/room",
            data: {
                "roomId" :targetRoom
            },
            success: function (data){
            }

        });
    }

</script>
</html>